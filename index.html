
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="about/">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>LTRXAR</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#extend-the-enterprise-wan-to-the-aws-cloud-a-first-hand-deployment-experience-using-ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="LTRXAR" class="md-header__button md-logo" aria-label="LTRXAR" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LTRXAR
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="LTRXAR" class="md-nav__button md-logo" aria-label="LTRXAR" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LTRXAR
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Home
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#speakers" class="md-nav__link">
    Speakers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-key-concepts" class="md-nav__link">
    Introduction to key concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-export-demonstration" class="md-nav__link">
    Template Export (demonstration)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-export-template-dump" class="md-nav__link">
    Template Export (template dump)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="about/" class="md-nav__link">
        About This Lab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="env_setup/" class="md-nav__link">
        Environment Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Scenario 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Scenario 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc_1_desc/" class="md-nav__link">
        Description
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t1/" class="md-nav__link">
        Task 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t2/" class="md-nav__link">
        Task 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t3/" class="md-nav__link">
        Task 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t4/" class="md-nav__link">
        Task 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t5/" class="md-nav__link">
        Task 5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t6/" class="md-nav__link">
        Task 6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t7/" class="md-nav__link">
        Task 7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_t8/" class="md-nav__link">
        Task 8
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc1_recap/" class="md-nav__link">
        Recap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Scenario 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Scenario 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="scenario_2/" class="md-nav__link">
        Scenario 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sc_2_validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="sc_2_cont_edu/" class="md-nav__link">
        Continue Your Education
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#speakers" class="md-nav__link">
    Speakers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-key-concepts" class="md-nav__link">
    Introduction to key concepts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-export-demonstration" class="md-nav__link">
    Template Export (demonstration)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template-export-template-dump" class="md-nav__link">
    Template Export (template dump)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="extend-the-enterprise-wan-to-the-aws-cloud-a-first-hand-deployment-experience-using-ansible">Extend the Enterprise WAN to the AWS Cloud: A first-hand deployment experience using Ansible</h1>
<p>LTRXAR-2001</p>
<h2 id="speakers">Speakers</h2>
<p>Kyle Barnes – CX Architect, Praveen Poojary – CX Architect, Navin Suvarna – CX Architect</p>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>Upon completion of this lab, you will be able to understand the following:<br />
•   Viptela SD-WAN device vs feature templates<br />
•   Understand basic Ansible structure (playbooks, roles, variables, modules)<br />
•   Available Cisco Viptela Modules<br />
•   Ansible installation process<br />
•   Viptela SD-WAN API documentation<br />
•   Viptela Cloud OnRamp process<br />
•   Viptela Cloud OnRamp APIs  </p>
<p>Cisco SD-WAN includes a useful tool for configuration management and network monitoring: <strong>vManage</strong>. Within the SD-WAN fabric, the vManage tool is responsible for handling the <strong>management plane</strong>, meaning that all the configurations can be performed from its graphical user interface (GUI). The vManage tool also offers a rich set of REST APIs, enabling you to automate specific workflows using your favorite tool, such as Postman, Python, Ansible, and others.</p>
<h2 id="introduction-to-key-concepts">Introduction to key concepts</h2>
<p>In the SD-WAN environment, you must still manage configuration of devices (vEdges) independently. This is because the SD-WAN fabric is widely distributed in the wide-area network (WAN).
The vManage is a single point of configuration for the whole WAN fabric and uses a templates to simplify configuration management. In SD-WAN, you can configure every feature with a feature template. Templates ensure that the configuration is consistent across all the devices. Feature templates are grouped together into device templates that will be attached to the end devices.  </p>
<p><strong>What is a feature template?</strong>  </p>
<p>Feature templates are the building blocks of complete configuration for a device. For each feature that you can enable on a device, Cisco vManage provides a template form that you fill out. The form allows you to set the values for all configurable parameters for that feature.
Because device configurations vary for different device types and the different types of routers, feature templates are specific to the type of device. </p>
<p><strong>How does this differ from device templates?</strong></p>
<p>Device templates use feature templates!  Device templates contain complete operational configuration for a device. You create device templates by consolidating individual feature templates.  Each device template is specific for a type of device. For each device type, if multiple devices have the same configuration, you can use the same device template for them. For example, many of the routers in a network might have the same basic configuration, so you can configure them with the same templates. (You specify the differences in the templates using configuration variables, which are discussed below.) If the configurations for the same type of devices are different, you create separate device templates.
For the first scenario, we’ll be creating &amp; using several Ansible playbooks.  The purpose of this scenario is to familiarize yourself with the YAML playbook syntax and to better understand feature and device templates within an SD-WAN fabric.<br />
One thing you’ll find throughout these subsequent tasks are a few Ansible playbooks that leverage vManage modules within Ansible found here: <a href="https://github.com/CiscoDevNet/python-viptela">https://github.com/CiscoDevNet/python-viptela</a>  </p>
<p><strong>What are modules?</strong>  </p>
<p>“Ansible modules are units of code that can control system resources or execute system commands. Ansible provides a module library that you can execute directly on remote hosts or through playbooks.”  In other words, modules are Python scripts that expect several inputs and can provide varying outputs.  </p>
<h2 id="template-export-demonstration">Template Export (demonstration)</h2>
<p>The first playbook we’ll create uses the ansible URI module to invoke an API call to vManage. The main API used here is the <strong>/dataservice/template/feature</strong> API.<br />
The /dataservice/ part of the URL represents the API entry point. The remainder, /template/feature/, identifies the resource that you are going to manipulate: in this case, feature templates.
The methods that you are going to use to manipulate feature template are:
GET: Retrieves information from the system.
POST: Creates a new object (in this case, a new feature template).
PUT: Modifies an existing object.
DELETE: Deletes an existing object</p>
<p>The default output is a JSON formatted list of the various device templates, and the template ID associated with each individual feature template.  </p>
<p><em>Note: The template ID will be used to uniquely identify the feature templates when we associate the feature templates with the device template at a later step.</em>      </p>
<p><img alt="Screenshot" src="img/template_export_1.png" /></p>
<p>The playbook then cycles through the json data and combines the feature template name &amp; feature template ID into a key/value pair.  These values are stored into a local variable called feature_template_db which is then printed.  </p>
<pre><code>- name: Export vManage Template
  hosts: vmanage
  gather_facts: no
  connection: local
  vars:
    file: vmanage-templates.yml
  #ALL YOUR POD/AWS SPECIFICS GO HERE#
  vars_files:
   - /home/dcloud/python-viptela/external_vars.yml
  tasks:
  - name: Get Cookies
    ansible.builtin.uri:
      url: https://{{ VMANAGE_IP }}/j_security_check
      method: POST
      body_format: form-urlencoded
      validate_certs: False
      body:
        j_username: &quot;{{ USERNAME }}&quot;
        j_password: &quot;{{ PASSWORD }}&quot;
    register: login
  - name: Output Cookie Info
    ansible.builtin.debug:
      var: login.cookies
  - name: Get XSRF
    ansible.builtin.uri:
      url: https://{{ VMANAGE_IP }}/dataservice/client/token
      method: GET
      body_format: json
      validate_certs: False
      return_content: true
      headers:
        Cookie: &quot;{{ login.cookies_string }}&quot;
    register: cookie_output
  - name: Cookie Output
    ansible.builtin.debug:
      var: cookie_output.content
##################################################################################
  - name: Get Feature Template
    uri:
      url: https://{{ VMANAGE_IP }}/dataservice/template/feature
      method: GET
      return_content: yes
      validate_certs: no
      headers:
        Cookie: &quot;{{ login.cookies_string }}&quot;
        X-XSRF-TOKEN:  &quot;{{ cookie_output.content }}&quot;
        Content-Type: &quot;application/json&quot;
    register: template_list
  - set_fact:
      feature_template_db: &quot;{{ feature_template_db|default({}) | combine( {item.templateName: item.templateId } ) }}&quot;
    no_log: True
    with_items: &quot;{{ template_list.json.data }}&quot;

  - debug:
      msg: &quot;{{ feature_template_db }}&quot;
</code></pre>
<p>Copy/paste this into a new yml file called “10_Export_Feature_Templates.yml” – this playbook will only be run for demonstration purposes and is not used in the subsequent sections.</p>
<p><img alt="Screenshot" src="img/template_export_2.png" /></p>
<p><strong>But wait?</strong>  What is the mess above the “<strong><em>*</em></strong><strong><em>*</em></strong><em><em>” line in playbook 10?  You’ll see this in differing flavours throughout this lab guide but the principal behind this is that before we can do </em>anything</em> using APIs we need to 1) authenticate (get a cookie) and  2) generate an XSRF token, using the cookie.  Between scenario 1 and 2 you’ll see this done in varying ways-using a role and/or part of the Ansible playbook.  The former option allows for cleaner, more concise Ansible playbook construction.  Regardless, URI calls to the vManage APIs are how we perform most (all) of the steps throughout this lab guide.   </p>
<p>This isn’t <em>always</em> how Ansible is used, though.  Executing these plays locally on the Ansible control node is being performed with the “Connection: local” syntax as the top of the Playbook.  Ansible <em>typically</em> works by connecting to your nodes and pushing out small programs—called modules—to these nodes. Modules are used to accomplish automation tasks in Ansible. These programs are written to be resource models of the desired state of the system. Ansible then executes these modules and removes them when finished.  For automating network devices and other IT appliances where modules cannot be executed, Ansible will run on the control node (i.e. what we’re doing for all of our Ansible plays).  </p>
<h2 id="template-export-template-dump">Template Export (template dump)</h2>
<p>Copy and paste the following into a new yml file called “11_Export_Existing_Templates.yml”
The purpose of this playbook is to use the the vmanage_template_export API (which should be visible within the python-viptela&gt;ansible&gt;modules directory within the github link).  The contents of this export are stored in the yml file ‘vmanage-templates.yml.’  We’ll leverage this ‘dump’ of feature templates in subsequent steps throughout Scenario 1.  But how?<br />
Before we get to that, execute the playbook and review the output of the vmanage-templates.yml file (created in the same directory as where the playbook is executed).  </p>
<pre><code>- name: Export vManage Template
  hosts: vmanage
  gather_facts: no
  connection: local
  vars:
    file: vmanage-templates.yml
  #ALL YOUR POD/AWS SPECIFICS GO HERE#
  vars_files:
   - /home/dcloud/python-viptela/external_vars.yml
  tasks:
  - name: Get Cookies
    ansible.builtin.uri:
      url: https://{{ VMANAGE_IP }}/j_security_check
      method: POST
      body_format: form-urlencoded
      validate_certs: False
      body:
        j_username: &quot;{{ USERNAME }}&quot;
        j_password: &quot;{{ PASSWORD }}&quot;
    register: login
  - name: Output Cookie Info
    ansible.builtin.debug:
      var: login.cookies
  - name: Get XSRF
    ansible.builtin.uri:
      url: https://{{ VMANAGE_IP }}/dataservice/client/token
      method: GET
      body_format: json
      validate_certs: False
      return_content: true
      headers:
        Cookie: &quot;{{ login.cookies_string }}&quot;
    register: cookie_output
  - name: Cookie Output
    ansible.builtin.debug:
      var: cookie_output.content
##################################################################################
  tasks:
    - vmanage_template_export:
        user: &quot;{{ USERNAME }}&quot;
        host: &quot;{{ VMANAGE_IP }}&quot;
        password: &quot;{{ PASSWORD }}&quot;
        file: &quot;{{ file }}&quot;
</code></pre>
<p><img alt="Screenshot" src="img/template_dump_1.png" /></p>
<p>Now that we have this information available to us, we can effectively reverse engineer the existing templates to create a new device template of our own.  </p>
<p><em>How?</em></p>
<p>Before we answer how let’s cover two topics:<br />
<strong>Roles</strong>: A role in Ansible is a set of tasks that accomplish a specific goal within a playbook. Roles let you automatically load related vars, files, tasks, handlers, and other Ansible artifacts based on a known file structure. After you group your content in roles, you can easily reuse them and share them with other users.<br />
<strong>Jinja2</strong>: Jinja2 templates are simple template files that store variables that can change from time to time. When Playbooks are executed, these variables get replaced by actual values defined in Ansible Playbooks.  </p>
<p>Here is a high-level flow as to how we’ll leverage Jinja2 templates &amp; roles to develop our own device templates using Ansible.<br />
1.  Create roles via  Ansible Galaxy: “ansible-galaxy init ~/python-viptela/roles/<name-for-the-role>”  This creates a directory that we can populate that we can subsequently call across other playbooks.
Note: see the roles directory
2.  Identify what part do we want to work on (use VPN0 as an example)
3.  Create the j2 file from the vmanage-templates.yml blueprint (free online YML to j2 converters exist) using the portion we intend to modify (in step 2).<br />
4.  Modify j2 components that we intend to templatize.<br />
Note: We selected some things to demonstrate the key/value pair, but one could modify this with whatever factors you care to templatize. <br />
<img alt="Screenshot" src="img/template_dump_2.png" /></p>
<p>5. Create subsequent playbooks that call the role where the J2 file resides and pass the specific variables.<br />
6. The role will use the tasks main.yml file in a top-down format (render first, post second)
<img alt="Screenshot" src="img/template_dump_3.png" /></p>
<p>a.  Render: Create the JSON payload from the variables that are passed when the role is used
<img alt="Screenshot" src="img/template_dump_4.png" /></p>
<p>b.  Post: This may be a surprise, but post…performs a URI post using the rendered JSON file.<br />
<img alt="Screenshot" src="img/template_dump_5.png" /></p>
<p>To summarize the high-level components within the roles directories:</p>
<p><img alt="Screenshot" src="img/template_dump_6.png" /></p>
<p>Templates: This is where the actual j2 file lives.<br />
Tasks:  Where we render the JSON payload and post when the role is referenced.<br />
Files: Latest JSON payload, with passed variables populated.</p>
<p>Note: An Ansible role has a defined directory structure with eight main standard directories. You must include at least one of these directories in each role. You can omit any directories the role does not use.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>